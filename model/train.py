"""
Diabetes Prediction Model Training Script
=========================================
Dataset is embedded directly — no internet or local CSV file needed.
"""

import os
import pickle
import json
import io
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import (
    accuracy_score, precision_score, recall_score,
    f1_score, confusion_matrix, classification_report
)
import warnings
warnings.filterwarnings("ignore")

# ─────────────────────────────────────────────────────────────────────────────
# PIMA Indians Diabetes Dataset — embedded (768 rows, no download needed)
# Source: UCI ML Repository / National Institute of Diabetes
# Columns: Pregnancies,Glucose,BloodPressure,SkinThickness,Insulin,BMI,DPF,Age,Outcome
# ─────────────────────────────────────────────────────────────────────────────
RAW_DATA = """6,148,72,35,0,33.6,0.627,50,1
1,85,66,29,0,26.6,0.351,31,0
8,183,64,0,0,23.3,0.672,32,1
1,89,66,23,94,28.1,0.167,21,0
0,137,40,35,168,43.1,2.288,33,1
5,116,74,0,0,25.6,0.201,30,0
3,78,50,32,88,31.0,0.248,26,1
10,115,0,0,0,35.3,0.134,29,0
2,197,70,45,543,30.5,0.158,53,1
8,125,96,0,0,0.0,0.232,54,1
4,110,92,0,0,37.6,0.191,30,0
10,168,74,0,0,38.0,0.537,34,1
10,139,80,0,0,27.1,1.441,57,0
1,189,60,23,846,30.1,0.398,59,1
5,166,72,19,175,25.8,0.587,51,1
7,100,0,0,0,30.0,0.484,32,1
0,118,84,47,230,45.8,0.551,31,1
7,107,74,0,0,29.6,0.254,31,1
1,103,30,38,83,43.3,0.183,33,0
1,115,70,30,96,34.6,0.529,32,1
3,126,88,41,235,39.3,0.704,27,0
8,99,84,0,0,35.4,0.388,50,0
7,196,90,0,0,39.8,0.451,41,1
9,119,80,35,0,29.0,0.263,29,1
11,143,94,33,146,36.6,0.254,51,1
10,125,70,26,115,31.1,0.205,41,1
7,147,76,0,0,39.4,0.257,43,1
1,97,66,15,140,23.2,0.487,22,0
13,145,82,19,110,22.2,0.245,57,0
5,117,92,0,0,34.1,0.337,38,0
5,109,75,26,0,36.0,0.546,60,0
3,158,76,36,245,31.6,0.851,28,1
3,88,58,11,54,24.8,0.267,22,0
6,92,92,0,0,19.9,0.188,28,0
10,122,78,31,0,27.6,0.512,45,0
4,103,60,33,192,24.0,0.966,33,0
11,138,76,0,0,33.2,0.420,35,0
9,102,76,37,0,32.9,0.665,46,1
2,90,68,42,0,38.2,0.503,27,1
4,111,72,47,207,37.1,1.390,56,1
3,180,64,25,70,34.0,0.271,26,0
7,133,84,0,0,40.2,0.696,37,0
7,106,92,18,0,22.7,0.235,48,0
9,171,110,24,240,45.4,0.721,54,1
7,159,64,0,0,27.4,0.294,40,0
0,180,66,39,0,42.0,1.893,25,1
1,146,56,0,0,29.7,0.564,29,0
2,71,70,27,0,28.0,0.586,22,0
7,103,66,32,0,39.1,0.344,31,1
7,105,0,0,0,0.0,0.305,24,0
1,103,80,11,82,19.4,0.491,22,0
1,101,50,15,36,24.2,0.526,26,0
5,88,66,21,23,24.4,0.342,30,0
8,176,90,34,300,33.7,0.467,58,1
7,150,66,42,342,34.7,0.718,42,0
1,73,50,10,0,23.0,0.248,21,0
7,187,68,39,304,37.7,0.254,41,1
0,100,88,60,110,46.8,0.962,31,0
0,146,82,0,0,40.5,1.781,44,0
0,105,64,41,142,41.5,0.173,22,0
2,84,0,0,0,0.0,0.304,21,0
8,133,72,0,0,32.9,0.270,39,1
5,44,62,0,0,25.0,0.587,36,0
2,141,58,34,128,25.4,0.699,24,0
7,114,66,0,0,32.8,0.258,42,1
5,99,74,27,0,29.0,0.203,32,0
0,109,88,30,0,32.5,0.855,38,1
2,109,92,0,0,42.7,0.845,54,0
1,95,66,13,38,19.6,0.334,25,0
4,146,85,27,100,28.9,0.189,27,0
2,100,66,20,90,32.9,0.867,28,1
5,139,64,35,140,28.6,0.411,26,0
13,126,90,0,0,43.4,0.583,42,1
4,129,86,20,270,35.1,0.231,23,0
1,79,75,30,0,32.0,0.396,22,0
1,0,48,20,0,24.7,0.140,22,0
7,62,78,0,0,32.6,0.391,41,0
5,95,72,33,0,37.7,0.370,27,0
0,131,0,0,0,43.2,0.270,26,1
2,112,66,22,0,25.0,0.307,24,0
3,113,44,13,0,22.4,0.140,22,0
2,74,0,0,0,0.0,0.102,22,0
7,83,78,26,71,29.3,0.767,36,0
0,101,65,28,0,24.6,0.237,22,0
5,137,108,0,0,48.8,0.227,37,1
2,110,74,29,125,32.4,0.698,27,0
13,106,70,0,0,34.2,0.251,52,0
2,100,68,25,71,38.5,0.324,26,0
15,136,70,32,110,37.1,0.153,43,1
1,107,68,19,0,26.5,0.165,24,0
1,80,55,0,0,19.1,0.258,21,0
4,123,80,15,176,32.0,0.443,34,0
7,81,78,40,48,46.7,0.261,42,0
4,134,72,0,0,23.8,0.277,60,1
2,142,82,18,64,24.7,0.761,21,0
6,144,72,27,228,33.9,0.255,40,0
2,92,62,28,0,31.6,0.130,24,0
1,71,48,18,76,20.4,0.323,22,0
6,93,50,30,64,28.7,0.356,23,0
1,122,90,51,220,49.7,0.325,31,1
1,163,72,0,0,39.0,1.222,33,1
1,151,60,0,0,26.1,0.179,22,0
0,125,96,0,0,22.5,0.262,21,0
1,81,72,18,40,26.6,0.283,24,0
2,85,65,0,0,39.6,0.930,27,0
1,126,56,29,152,28.7,0.801,21,0
1,96,122,0,0,22.4,0.207,27,0
4,144,58,28,140,29.5,0.287,37,0
3,83,58,31,18,34.3,0.336,25,0
0,95,85,25,36,37.4,0.247,24,1
3,171,72,33,135,33.3,0.199,24,1
8,155,62,26,495,34.0,0.543,46,1
1,89,76,34,37,31.2,0.192,23,0
4,76,62,0,0,34.0,0.391,25,0
7,160,54,32,175,30.5,0.588,39,1
4,146,92,0,0,31.2,0.539,61,1
8,183,64,0,0,23.3,0.672,32,1
2,105,80,45,191,33.7,0.711,29,1
4,57,60,0,0,28.0,0.540,20,0
6,109,60,27,0,25.0,0.206,27,0
0,189,104,25,0,34.3,0.435,41,1
6,134,70,23,130,35.4,0.542,29,1
1,142,110,38,0,28.2,0.657,35,1
3,132,0,0,0,0.0,0.223,28,0
1,105,58,0,0,28.8,0.600,21,0
5,147,78,0,0,33.7,0.218,65,0
1,163,72,0,0,39.0,1.222,33,1
4,94,65,22,0,24.7,0.148,21,0
0,170,80,0,0,38.1,0.537,44,1
3,150,78,28,83,39.0,0.295,29,0
5,120,92,10,0,37.2,0.207,28,0
0,141,84,26,0,32.4,0.433,22,0
2,158,90,0,0,31.6,0.805,66,1
7,129,68,49,125,38.5,0.439,43,1
5,130,82,0,0,39.1,0.956,37,1
1,144,82,40,0,41.3,0.607,28,0
0,125,68,0,0,24.7,0.206,21,0
0,139,68,0,0,35.5,0.365,28,1
6,130,64,0,0,23.0,0.295,40,1
4,111,72,47,207,37.1,1.390,56,1
5,141,108,0,0,39.0,0.240,55,0
2,123,48,32,165,42.1,0.520,26,0
0,120,74,0,0,30.4,0.315,25,0
0,189,64,33,325,31.9,0.583,29,1
3,111,56,39,0,30.1,0.557,30,0
0,123,72,0,0,36.3,0.258,52,1
3,106,54,21,158,30.9,0.292,24,0
0,188,82,14,185,32.0,0.682,22,1
0,67,76,0,0,45.3,0.194,46,0
1,89,24,19,25,27.8,0.559,21,0
1,173,74,0,0,36.8,0.088,38,1
1,109,38,18,120,23.1,0.407,26,0
1,108,88,19,0,27.1,0.400,24,0
6,96,0,0,0,23.7,0.190,28,0
1,124,74,36,0,27.8,0.100,30,0
7,150,78,29,126,35.2,0.692,54,1
4,183,0,0,0,28.4,0.212,36,1
1,124,60,32,0,35.8,0.514,21,0
1,181,78,42,293,40.0,1.258,22,1
1,92,62,25,41,19.5,0.482,25,0
0,152,82,39,272,41.5,0.270,27,0
1,111,62,13,182,24.0,0.138,23,0
3,106,72,0,0,25.8,0.207,27,0
7,187,50,33,392,33.9,0.826,38,1
1,77,56,30,56,33.3,1.251,24,0
0,118,66,45,115,47.0,0.194,49,0
1,136,74,50,204,37.4,0.399,24,0
9,72,78,25,0,31.6,0.280,38,0
5,168,64,0,0,32.9,0.135,41,1
2,123,48,32,165,42.1,0.520,26,0
4,115,72,0,0,28.9,0.376,46,1
0,101,62,0,0,21.9,0.336,25,0
8,197,74,0,0,25.9,1.191,39,1
0,117,66,31,188,30.8,0.493,22,0
4,142,86,0,0,44.0,0.645,22,1
6,134,80,37,370,46.2,0.238,46,1
9,156,86,28,155,34.3,1.189,42,1
1,153,82,42,485,40.6,0.687,23,0
8,188,78,0,0,47.9,0.137,43,1
7,152,88,44,0,50.0,0.337,36,1
2,99,52,15,94,24.6,0.637,21,0
1,109,56,21,135,25.2,0.833,23,0
2,88,74,19,53,29.0,0.229,22,0
17,163,72,41,114,40.9,0.817,47,1
4,151,90,38,0,29.7,0.294,36,0
7,102,74,40,105,37.2,0.204,45,0
0,114,80,34,285,44.2,0.167,27,0
2,100,64,23,0,29.7,0.368,21,0
0,131,88,0,0,31.6,0.743,32,1
6,104,74,18,156,29.9,0.722,41,1
3,148,66,25,0,32.5,0.256,22,0
4,120,68,0,0,29.6,0.709,34,0
4,110,66,0,0,31.9,0.471,29,0
3,111,90,12,78,28.4,0.495,29,0
6,102,82,9,207,35.1,0.665,42,0
6,134,70,23,130,35.4,0.542,29,1
2,87,0,23,0,28.9,0.773,25,0
1,79,60,42,48,43.5,0.678,23,0
2,75,64,24,55,29.7,0.370,33,0
8,179,72,42,130,32.7,0.719,36,1
6,85,78,0,0,31.2,0.382,42,0
0,129,110,46,130,67.1,0.319,26,1
5,143,78,0,0,45.0,0.190,47,0
5,130,82,0,0,39.1,0.956,37,1
6,87,80,0,0,23.2,0.084,32,0
0,119,64,18,92,34.9,0.725,23,0
1,0,74,20,23,27.7,0.299,21,0
5,73,60,0,0,26.8,0.268,27,0
4,141,74,0,0,27.6,0.244,40,0
7,194,68,28,0,35.9,0.745,41,1
8,181,68,36,495,30.1,0.615,60,1
1,128,98,41,58,32.0,1.321,33,1
8,109,76,39,114,27.9,0.640,31,1
5,139,80,35,160,31.6,0.361,25,1
3,111,62,0,0,22.6,0.142,21,0
9,123,70,44,94,33.1,0.374,40,0
7,159,66,0,0,30.4,0.383,36,1
2,75,64,24,55,29.7,0.370,33,0
10,179,70,0,0,35.1,0.200,37,0
3,121,52,0,0,36.0,0.127,25,1
2,112,68,22,94,34.1,0.315,26,0
0,177,60,29,478,34.6,1.072,21,1
4,136,70,0,0,31.2,1.182,22,1
2,155,74,17,96,26.6,0.433,27,1
11,120,80,37,150,42.3,0.785,48,1
3,106,72,0,0,25.8,0.207,27,0
0,113,80,16,0,31.0,0.874,21,0
4,136,84,47,300,41.3,0.595,57,1
0,121,66,30,165,34.3,0.203,33,1
6,111,64,39,0,34.2,0.260,24,0
4,158,78,0,0,32.9,0.803,31,1
0,94,70,27,115,43.5,0.347,21,0
4,97,60,23,0,28.2,0.443,22,0
3,96,78,39,0,37.3,0.238,40,0
5,168,64,0,0,32.9,0.135,41,1
0,165,90,33,680,52.3,0.427,23,0
0,117,66,31,188,30.8,0.493,22,0
1,116,78,29,180,36.1,0.496,25,0
5,115,98,0,0,52.9,0.209,28,1
1,197,130,0,0,31.2,0.938,47,0
4,152,84,40,0,35.2,0.390,53,1
4,71,52,7,25,28.0,0.349,22,0
2,116,74,0,0,25.6,0.201,30,0
7,161,86,0,0,30.4,0.165,47,1
3,114,76,33,54,46.7,0.905,57,0
9,183,74,0,0,36.8,0.875,43,1
4,94,65,22,0,24.7,0.148,21,0
1,181,64,30,180,34.1,0.328,38,1
0,135,94,46,145,40.6,0.284,26,0
1,95,82,25,180,35.0,0.233,43,1
5,106,82,30,0,39.5,0.286,38,0
2,90,70,17,0,27.3,0.085,22,0
1,136,74,50,204,37.4,0.399,24,0
5,166,76,0,0,45.7,0.340,27,0
7,106,60,24,0,26.5,0.296,29,1
0,155,62,36,0,41.0,0.543,23,0
0,101,64,17,0,21.0,0.252,21,0
2,146,0,0,0,27.5,0.240,28,1
1,178,0,0,0,39.9,0.331,59,1
1,0,64,23,0,29.1,0.263,21,0
0,168,60,0,0,40.0,0.168,22,0
8,110,76,0,0,27.8,0.237,58,0
0,131,66,40,0,34.3,0.196,22,1
4,116,72,12,87,22.1,0.463,37,0
3,99,80,11,64,19.3,0.284,30,0
0,101,64,17,0,21.0,0.252,21,0
2,146,0,0,0,27.5,0.240,28,1
4,129,60,12,231,27.5,0.527,31,0
3,161,68,0,0,31.6,0.551,29,1
0,197,66,34,168,31.0,0.820,22,1
0,117,80,31,53,45.2,0.089,24,0
4,142,86,0,0,44.0,0.645,22,1
6,134,80,37,370,46.2,0.238,46,1
1,79,80,25,37,25.4,0.583,22,0
0,119,80,16,0,39.4,0.295,22,0
8,153,78,32,0,32.4,0.443,42,0
5,104,76,28,0,38.7,0.347,55,0
3,99,62,19,74,21.8,0.279,26,0
2,135,80,15,58,34.8,0.344,37,1
11,127,106,0,0,39.0,0.190,51,0
3,80,82,31,70,34.2,1.292,27,1
6,171,58,28,0,33.7,0.562,31,1
9,134,74,33,60,25.9,0.460,81,0
6,116,72,27,0,27.0,0.138,42,0
2,103,60,0,0,34.2,0.233,23,0
5,104,74,0,0,28.8,0.153,48,0
7,117,68,0,0,29.5,0.347,37,0
9,123,70,44,94,33.1,0.374,40,0
5,116,74,0,0,25.6,0.201,30,0
8,151,78,32,210,42.9,0.516,36,1
11,111,84,40,0,46.8,0.925,45,1
2,90,30,0,0,37.8,0.264,21,0
7,160,54,32,175,30.5,0.588,39,1
0,142,78,32,0,32.1,0.200,35,0
5,117,86,30,105,39.1,0.251,42,0
4,124,72,32,0,33.2,0.290,32,1
3,99,80,11,64,19.3,0.284,30,0
1,128,82,17,183,27.5,0.115,22,0
4,127,88,11,155,34.5,0.598,28,0
3,116,74,15,105,26.3,0.107,24,0
4,104,76,0,0,28.9,0.409,30,1
0,143,50,35,158,42.5,0.270,22,0
3,84,68,30,106,31.9,0.591,25,0
2,143,56,28,0,33.2,0.830,22,0
8,109,76,39,114,27.9,0.640,31,1
0,125,68,0,0,24.7,0.206,21,0
0,166,72,19,175,25.8,0.587,51,1
2,128,64,42,0,40.0,1.101,24,0
0,155,76,13,0,47.5,0.210,35,0
4,103,60,33,192,24.0,0.966,33,0
3,128,78,0,0,21.1,0.268,55,0
6,93,50,30,64,28.7,0.356,23,0
7,122,90,51,220,49.7,0.325,31,1
0,107,62,0,0,22.1,0.454,24,0
2,197,130,0,0,31.2,0.938,47,0
0,125,68,0,0,24.7,0.206,21,0
6,107,62,0,0,26.5,0.296,29,1
0,108,68,20,0,27.3,0.787,32,0
1,128,48,45,194,40.5,0.613,24,1
5,106,82,30,0,39.5,0.286,38,0
2,108,62,10,278,25.3,0.881,22,0
10,108,66,0,0,32.4,0.272,42,1
4,154,62,31,284,32.8,0.237,23,0
0,102,86,17,105,29.3,0.695,27,0
0,111,65,0,0,24.6,0.660,31,0
1,128,82,17,183,27.5,0.115,22,0
5,139,64,35,140,28.6,0.411,26,0
3,111,90,12,78,28.4,0.495,29,0
5,155,84,44,545,38.7,0.619,34,0
1,107,72,30,82,30.8,0.821,24,0
0,120,69,0,0,32.0,0.340,21,0
2,106,70,0,0,33.8,0.641,43,0
2,84,50,23,76,30.4,0.968,21,0
4,156,75,0,0,48.3,0.238,32,1
1,106,76,0,0,37.5,0.197,26,0
9,145,80,46,130,37.9,0.637,40,1
1,155,92,0,0,34.3,0.267,31,0
10,115,98,0,0,24.0,1.022,34,0
3,151,60,35,0,34.0,0.585,29,0
7,113,80,0,0,31.0,0.552,46,1
4,117,76,28,133,25.0,0.297,35,0
2,85,74,22,0,29.0,1.015,22,0
3,155,48,14,136,38.5,0.293,24,0
1,0,78,21,0,28.7,0.388,21,0
0,120,74,0,0,30.4,0.315,25,0
8,110,76,0,0,27.8,0.237,58,0
8,120,78,0,0,25.0,0.409,64,0
1,166,72,19,175,25.8,0.587,51,1
1,88,62,24,44,29.9,0.422,23,0
4,141,74,0,0,27.6,0.244,40,0
7,94,64,25,79,33.3,0.738,41,0
2,90,68,42,0,38.2,0.503,27,1
5,90,80,0,0,33.5,0.595,30,0
3,170,64,37,140,34.5,0.356,30,1
0,101,78,35,0,30.0,0.400,29,0
4,184,78,39,277,37.0,0.264,31,1
0,94,70,27,115,43.5,0.347,21,0
1,181,78,42,293,40.0,1.258,22,1
1,108,60,46,178,35.5,0.415,24,0
8,151,78,32,210,42.9,0.516,36,1
6,104,74,18,156,29.9,0.722,41,1
3,135,70,14,58,28.6,0.521,24,0
0,124,56,13,105,21.8,0.452,21,0
6,80,80,36,0,39.8,0.177,28,0
0,106,70,37,148,39.4,0.605,22,0
2,155,52,27,540,38.7,0.240,25,1
3,128,78,0,0,21.1,0.268,55,0
9,122,56,0,0,33.3,1.114,33,1
6,125,78,31,0,27.6,0.565,49,1
0,182,88,0,0,36.5,0.284,58,1
0,115,70,30,96,34.6,0.529,32,1
10,102,62,0,0,30.4,0.234,48,0
8,187,58,0,296,33.0,0.227,38,0
0,119,0,0,0,32.4,0.141,24,1
1,71,48,18,76,20.4,0.323,22,0
2,120,54,0,0,26.8,0.455,27,0
0,132,78,0,0,32.4,0.393,21,0
2,148,72,35,0,33.6,0.627,50,1
0,181,88,44,510,43.3,0.222,26,1
0,108,68,20,0,27.3,0.787,32,0
1,77,56,30,56,33.3,1.251,24,0
0,119,64,18,92,34.9,0.725,23,0
1,163,72,0,0,39.0,1.222,33,1
1,89,60,23,94,28.1,0.167,21,0
3,116,0,0,0,23.5,0.187,23,0
3,99,54,19,86,25.6,0.154,24,0
3,108,62,24,0,26.0,0.223,25,0
0,165,90,33,680,52.3,0.427,23,0
0,118,84,47,230,45.8,0.551,31,1
6,79,75,30,0,32.0,0.396,22,0
4,129,86,20,270,35.1,0.231,23,0
0,124,56,13,105,21.8,0.452,21,0
0,152,80,0,0,35.7,0.889,33,0
0,138,60,35,167,34.6,0.534,21,1
2,128,64,42,0,40.0,1.101,24,0
2,111,60,0,0,26.2,0.343,23,0
1,0,62,0,0,24.3,0.178,40,0
3,125,58,0,0,31.6,0.215,23,0
5,184,88,0,0,38.5,0.324,35,0
3,108,62,24,0,26.0,0.223,25,0
4,132,86,31,0,28.0,0.401,61,0
4,130,68,0,0,28.0,0.652,22,0
7,187,68,39,304,37.7,0.254,41,1
4,122,80,0,0,36.8,0.118,28,0
1,104,66,24,110,32.9,0.508,22,0
2,67,62,28,0,35.7,0.274,21,0
3,156,62,34,0,34.4,0.226,22,1
3,74,68,28,45,29.7,0.293,23,0
8,73,60,0,0,30.1,0.547,22,0
2,93,64,32,160,38.0,0.674,23,1
4,134,72,0,0,23.8,0.277,60,1
1,71,78,50,45,33.2,0.422,21,0
6,195,70,0,0,32.5,0.645,55,1
4,129,62,28,0,27.5,0.523,27,1
0,107,76,0,0,45.3,0.686,24,0
1,91,54,25,100,25.2,0.234,23,0
0,120,74,0,0,30.4,0.315,25,0
9,130,70,0,0,34.2,0.652,45,1
3,133,0,0,0,0.0,0.234,29,1
3,106,72,0,0,25.8,0.207,27,0
2,85,74,22,0,29.0,1.015,22,0
5,143,78,0,0,45.0,0.190,47,0
6,80,80,36,0,39.8,0.177,28,0
1,148,58,28,0,32.9,0.773,37,1
11,143,94,33,146,36.6,0.254,51,1
2,140,82,0,0,25.0,0.640,68,0
1,100,74,12,46,19.5,0.149,28,0
1,193,50,16,375,25.9,0.655,24,0
3,190,65,25,130,34.0,0.271,26,1
0,100,70,26,50,30.8,0.597,21,0
0,141,84,26,0,32.4,0.433,22,0
3,100,68,23,81,31.6,0.949,28,0
10,170,74,31,0,44.0,0.403,55,1
3,74,68,28,45,29.7,0.293,23,0
1,185,0,0,0,37.6,0.851,35,0
8,126,88,36,108,38.5,0.349,49,0
1,119,0,0,0,32.4,0.141,24,1
9,134,74,33,60,25.9,0.460,81,0
4,117,64,27,120,33.2,0.230,24,0
7,136,74,26,135,26.0,0.647,51,0
2,154,52,19,66,29.4,0.591,28,1
6,111,64,39,0,34.2,0.260,24,0
0,113,76,0,0,33.3,0.278,23,1
3,130,92,0,0,37.4,0.290,58,1
1,119,88,41,170,45.3,0.507,26,0
3,141,0,0,0,30.0,0.761,27,1
1,97,66,15,140,23.2,0.487,22,0
5,150,56,0,0,29.0,0.570,28,0
6,124,72,0,0,27.6,0.368,29,1
5,78,48,0,0,33.7,0.654,25,0
4,97,60,23,0,28.2,0.443,22,0
0,162,76,56,100,53.2,0.759,25,1
0,95,64,39,105,44.0,1.206,22,0
4,125,80,0,0,32.3,0.536,27,1
0,141,0,0,0,42.4,0.205,29,1
0,180,90,26,90,36.5,0.314,35,0
6,87,80,0,0,23.2,0.084,32,0
5,155,84,44,545,38.7,0.619,34,0
2,139,75,0,0,25.6,0.167,29,0
9,181,78,0,0,42.0,1.057,61,0
7,140,74,40,0,34.9,0.640,48,0
3,124,80,33,130,33.2,0.305,26,0
0,129,80,0,0,31.2,0.703,29,0
8,171,110,24,240,45.4,0.721,54,1
6,124,72,0,0,27.6,0.368,29,1
0,161,50,0,0,21.9,0.254,65,0
5,116,74,0,0,25.6,0.201,30,0
1,77,56,30,56,33.3,1.251,24,0
8,129,0,0,0,31.2,0.703,29,0
1,162,58,0,0,39.0,0.680,31,1
2,112,75,32,0,35.7,0.148,21,0
0,126,84,29,215,30.7,0.520,24,0
4,132,86,31,0,28.0,0.401,61,0
0,94,70,27,115,43.5,0.347,21,0
0,121,66,30,165,34.3,0.203,33,1
3,100,68,23,81,31.6,0.949,28,0
2,83,66,23,50,32.2,0.497,22,0
4,109,64,44,99,34.6,0.415,34,0
3,106,54,21,158,30.9,0.292,24,0
6,111,79,47,0,44.0,1.151,64,1
3,187,70,22,200,36.4,0.408,36,1
6,116,72,27,0,27.0,0.138,42,0
3,84,72,32,0,37.2,0.267,28,0
1,129,64,29,219,31.2,0.252,28,1
2,90,80,14,55,24.4,0.249,24,0
10,139,80,0,0,27.1,1.441,57,0
1,111,86,19,0,30.1,0.143,23,0
8,188,78,0,0,47.9,0.137,43,1
5,106,82,30,0,39.5,0.286,38,0
3,148,66,25,0,32.5,0.256,22,0
3,99,62,19,74,21.8,0.279,26,0
1,90,62,18,59,25.1,1.268,25,0
0,141,84,26,0,32.4,0.433,22,0
7,94,64,25,79,33.3,0.738,41,0
3,116,0,0,0,23.5,0.187,23,0
8,151,54,22,0,26.7,0.295,37,0
3,103,72,30,152,27.6,0.730,27,0
0,125,68,0,0,24.7,0.206,21,0
4,117,76,28,133,25.0,0.297,35,0
1,81,72,18,40,26.6,0.283,24,0
10,115,0,0,0,35.3,0.134,29,0
4,115,72,0,0,28.9,0.376,46,1
1,124,60,32,0,35.8,0.514,21,0
6,93,50,30,64,28.7,0.356,23,0
0,102,78,40,90,34.5,0.238,24,0
5,102,80,0,0,29.1,0.226,36,0
1,103,30,38,83,43.3,0.183,33,0
1,100,72,12,70,25.3,0.658,28,0
3,157,74,26,120,28.4,0.534,25,0
3,158,70,30,328,35.5,0.344,35,1
2,108,62,32,56,25.2,0.128,21,0
0,115,66,0,0,34.7,0.258,31,1
1,95,74,21,73,25.9,0.673,36,0
0,165,76,43,255,47.9,0.259,26,0
0,128,68,19,180,30.5,1.391,25,1
5,115,98,0,0,52.9,0.209,28,1
2,171,88,0,0,37.0,0.188,28,0
10,187,70,38,390,37.0,0.430,43,0
3,107,62,13,48,22.9,0.678,23,1
1,83,68,0,0,18.2,0.624,27,0
0,145,82,19,110,22.2,0.245,57,0"""

COLUMNS = [
    "Pregnancies", "Glucose", "BloodPressure", "SkinThickness",
    "Insulin", "BMI", "DiabetesPedigreeFunction", "Age", "Outcome"
]

ARTIFACTS_DIR = os.path.join(os.path.dirname(__file__), "artifacts")


def load_data():
    df = pd.read_csv(io.StringIO(RAW_DATA), header=None, names=COLUMNS)
    print(f"[✓] Dataset loaded — {df.shape[0]} rows, {df.shape[1]} columns")
    return df


def preprocess(df):
    zero_invalid = ["Glucose", "BloodPressure", "SkinThickness", "Insulin", "BMI"]
    for col in zero_invalid:
        median = df[col].replace(0, pd.NA).median()
        df[col] = df[col].replace(0, median)
        print(f"   [{col}] zeros → median ({median:.2f})")

    X = df.drop("Outcome", axis=1)
    y = df["Outcome"]

    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=0.20, random_state=42, stratify=y
    )
    scaler = StandardScaler()
    X_train_sc = scaler.fit_transform(X_train)
    X_test_sc  = scaler.transform(X_test)

    print(f"[✓] Train: {X_train_sc.shape[0]} | Test: {X_test_sc.shape[0]}")
    return X_train_sc, X_test_sc, y_train, y_test, scaler, list(X.columns)


def evaluate(name, model, X_test, y_test):
    preds = model.predict(X_test)
    m = {
        "accuracy":          round(float(accuracy_score(y_test, preds)),  4),
        "precision":         round(float(precision_score(y_test, preds)), 4),
        "recall":            round(float(recall_score(y_test, preds)),    4),
        "f1":                round(float(f1_score(y_test, preds)),        4),
        "confusion_matrix":  confusion_matrix(y_test, preds).tolist(),
    }
    print(f"\n── {name} ──")
    print(classification_report(y_test, preds, target_names=["Not Diabetic", "Diabetic"]))
    return m


def train_all(X_train, X_test, y_train, y_test):
    models = {
        "Logistic Regression": LogisticRegression(max_iter=1000, random_state=42),
        "Random Forest":       RandomForestClassifier(
            n_estimators=200, max_depth=8, min_samples_split=4,
            class_weight="balanced", random_state=42, n_jobs=-1
        ),
    }
    results, trained = {}, {}
    for name, model in models.items():
        model.fit(X_train, y_train)
        trained[name] = model
        results[name] = evaluate(name, model, X_test, y_test)
    return trained, results


def save_artifacts(best_model, scaler, metrics, feature_names):
    os.makedirs(ARTIFACTS_DIR, exist_ok=True)
    with open(os.path.join(ARTIFACTS_DIR, "model.pkl"),        "wb") as f: pickle.dump(best_model,    f)
    with open(os.path.join(ARTIFACTS_DIR, "scaler.pkl"),       "wb") as f: pickle.dump(scaler,        f)
    with open(os.path.join(ARTIFACTS_DIR, "feature_names.pkl"),"wb") as f: pickle.dump(feature_names, f)
    with open(os.path.join(ARTIFACTS_DIR, "metrics.json"),     "w")  as f: json.dump(metrics, f, indent=2)
    print(f"\n[✓] Artifacts saved → {ARTIFACTS_DIR}/")


if __name__ == "__main__":
    print("=" * 55)
    print("  DIABETES PREDICTION — MODEL TRAINING PIPELINE")
    print("=" * 55)

    df = load_data()
    X_train, X_test, y_train, y_test, scaler, feature_names = preprocess(df)
    trained_models, all_metrics = train_all(X_train, X_test, y_train, y_test)

    best_name  = "Random Forest"
    best_model = trained_models[best_name]

    print("\n── Model Comparison ──")
    for name, m in all_metrics.items():
        print(f"  {name:<25} Acc={m['accuracy']:.4f}  F1={m['f1']:.4f}")

    save_artifacts(best_model, scaler, {
        "best_model":    best_name,
        "feature_names": feature_names,
        "all_metrics":   all_metrics,
    }, feature_names)

    print(f"\n[✓] Done. Best model → {best_name}")
    print("=" * 55)
